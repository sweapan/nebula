<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=9"/>
		<meta name="generator" content="Doxygen 1.9.0"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>Nebula: Threading Namespace Reference</title>
		<link href="tabs.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="dynsections.js"></script>
		<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
		<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
		<link href="doxygen.css" rel="stylesheet" type="text/css" />
		<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom_dark_theme.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectalign" style="padding-left: 0.5em;">
							<div id="projectname">Nebula
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part --><!-- Generated by Doxygen 1.9.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('namespace_threading.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">Threading Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A mutex object which will assert instead of lock the thread. </p>
<p>A frame pass prepares a rendering sequence, draws and subpasses must reside within one of these objects.</p>
<dl class="section copyright"><dt>Copyright</dt><dd>(C) 2020 Individual contributors, see AUTHORS file</dd></dl>
<pre class="fragment">A lock-free queue implements a queue which completely relies on atomic operations.

All operations first performs a detachment of a node, followed by a modification of that node.

Removal:

1. Get the node you want to pop.
2. If non-null, get the next node from 1.
3. Do an interlocked comparison-swap, if we won the race, set head to the next node.
4. Otherwise, go back to 1.
5. oldHead is now a node which is detached and can not be reached by any other thread.

Node* oldHead;
Node* newHead;
while (true)
{
    oldHead = this-&gt;head;
    if (oldHead == nullptr)
        return false;

    newHead = oldHead-&gt;next;
    if (CompareAndSwap(&amp;this-&gt;head, oldHead, newHead))
        break;
}

Insertion:

1. Get the value you expect to modify (head, tail, free head, free tail)
2. Do an interlocked comparison exchange, check if value from 1. matches current value of what you expect, exchange values.
3. If not, go back to 1.
4. oldTail is now detached and can not reached by any other thread.

Example:

Node* oldTail = nullptr;
while (true)
{
    oldTail = this-&gt;tail;
</pre><p> if we won the race (oldTail == this-&gt;tail), swap this-&gt;tail to newNode if (CompareAndSwap(&amp;this-&gt;tail, oldTail, newNode) break; }</p>
<p>if (oldTail != nullptr) oldTail-&gt;next = newNode;</p>
<p>This queue implements two linked lists. One for the resident nodes and one for the free nodes. The free nodes and resident nodes follow identical patterns, howeven the resident nodes will attempt to allocate from the free nodes (and assert that it worked) or return a node to the free list.</p>
<p>TODO: Add support for ABA - make a new type of node which accompanies the node pointer with an integer allowing for knowing if a node has been modified even if it's state looks identical. For example, we might be <a class="el" href="class_threading_1_1_thread.html">Thread</a> A running an Enqueue operation, and in the CompareAndSwap we assume we wont the race because this-&gt;tail is equivalent to oldTail, BUT! What can also happen is that between where we get oldTail and to the CompareAndSwap (CAS) operation, <a class="el" href="class_threading_1_1_thread.html">Thread</a> B comes in and does Enqueue, Dequeue, leaving us in the same state but with changes having happened. If we instead accompany each node with an atomic counter, and increase it for every time we make a modification, we can safetly do the CAS and know for sure if the node has been tampered with or not.</p>
<dl class="section copyright"><dt>Copyright</dt><dd>(C) 2020 Individual contributors, see AUTHORS file</dd>
<dd>
(C) 2016-2020 Individual contributors, see AUTHORS file </dd></dl>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_threading_1_1_asserting_mutex.html">AssertingMutex</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_threading_1_1_asserting_scope.html">AssertingScope</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_threading_1_1_critical_scope.html">CriticalScope</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_threading_1_1_lock_free_queue.html">LockFreeQueue</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_threading_1_1_object_ref.html">ObjectRef</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A thread-safe reference to a shared object.  <a href="class_threading_1_1_object_ref.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_threading_1_1_safe_flag.html">SafeFlag</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A thread-safe flag variable.  <a href="class_threading_1_1_safe_flag.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_threading_1_1_safe_priority_queue.html">SafePriorityQueue</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A thread-safe priority-sorted queue which protects itself with critical sections.  <a href="class_threading_1_1_safe_priority_queue.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_threading_1_1_safe_queue.html">SafeQueue</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thread-safe version of <a class="el" href="class_util_1_1_queue.html" title="Nebula&#39;s queue class (a FIFO container).">Util::Queue</a>.  <a href="class_threading_1_1_safe_queue.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a5a3ee688d0de0946e6d8f66b15736b86"><td class="memItemLeft" align="right" valign="top">typedef pthread_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_threading.html#a5a3ee688d0de0946e6d8f66b15736b86">ThreadId</a></td></tr>
<tr class="separator:a5a3ee688d0de0946e6d8f66b15736b86"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1f422ebb704683ecac909e4402eacf43"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_threading.html#a1f422ebb704683ecac909e4402eacf43">__ImplementClass</a> (<a class="el" href="class_threading_1_1_object_ref.html">Threading::ObjectRef</a>, 'OBJR', <a class="el" href="class_core_1_1_ref_counted.html">Core::RefCounted</a>)</td></tr>
<tr class="separator:a1f422ebb704683ecac909e4402eacf43"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a5620c6c1016951cd2f56ba670b5412ed"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="namespace_threading.html#a5a3ee688d0de0946e6d8f66b15736b86">ThreadId</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_threading.html#a5620c6c1016951cd2f56ba670b5412ed">InvalidThreadId</a> = 0</td></tr>
<tr class="separator:a5620c6c1016951cd2f56ba670b5412ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5620c6c1016951cd2f56ba670b5412ed"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="namespace_threading.html#a5a3ee688d0de0946e6d8f66b15736b86">ThreadId</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_threading.html#a5620c6c1016951cd2f56ba670b5412ed">InvalidThreadId</a> = 0</td></tr>
<tr class="separator:a5620c6c1016951cd2f56ba670b5412ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5620c6c1016951cd2f56ba670b5412ed"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="namespace_threading.html#a5a3ee688d0de0946e6d8f66b15736b86">ThreadId</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_threading.html#a5620c6c1016951cd2f56ba670b5412ed">InvalidThreadId</a> = 0</td></tr>
<tr class="separator:a5620c6c1016951cd2f56ba670b5412ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5620c6c1016951cd2f56ba670b5412ed"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="namespace_threading.html#a5a3ee688d0de0946e6d8f66b15736b86">ThreadId</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespace_threading.html#a5620c6c1016951cd2f56ba670b5412ed">InvalidThreadId</a> = 0xffffffff</td></tr>
<tr class="separator:a5620c6c1016951cd2f56ba670b5412ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a5a3ee688d0de0946e6d8f66b15736b86"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a3ee688d0de0946e6d8f66b15736b86">&#9670;&nbsp;</a></span>ThreadId</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef DWORD <a class="el" href="namespace_threading.html#a5a3ee688d0de0946e6d8f66b15736b86">Threading::ThreadId</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a1f422ebb704683ecac909e4402eacf43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f422ebb704683ecac909e4402eacf43">&#9670;&nbsp;</a></span>__ImplementClass()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Threading::__ImplementClass </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_threading_1_1_object_ref.html">Threading::ObjectRef</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">'OBJR'&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_core_1_1_ref_counted.html">Core::RefCounted</a>&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a5620c6c1016951cd2f56ba670b5412ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5620c6c1016951cd2f56ba670b5412ed">&#9670;&nbsp;</a></span>InvalidThreadId <span class="overload">[1/4]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="namespace_threading.html#a5a3ee688d0de0946e6d8f66b15736b86">ThreadId</a> Threading::InvalidThreadId = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a5620c6c1016951cd2f56ba670b5412ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5620c6c1016951cd2f56ba670b5412ed">&#9670;&nbsp;</a></span>InvalidThreadId <span class="overload">[2/4]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="namespace_threading.html#a5a3ee688d0de0946e6d8f66b15736b86">ThreadId</a> Threading::InvalidThreadId = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a5620c6c1016951cd2f56ba670b5412ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5620c6c1016951cd2f56ba670b5412ed">&#9670;&nbsp;</a></span>InvalidThreadId <span class="overload">[3/4]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="namespace_threading.html#a5a3ee688d0de0946e6d8f66b15736b86">ThreadId</a> Threading::InvalidThreadId = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a5620c6c1016951cd2f56ba670b5412ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5620c6c1016951cd2f56ba670b5412ed">&#9670;&nbsp;</a></span>InvalidThreadId <span class="overload">[4/4]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="namespace_threading.html#a5a3ee688d0de0946e6d8f66b15736b86">ThreadId</a> Threading::InvalidThreadId = 0xffffffff</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
		<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
			<ul>
				<li class="navelem"><a class="el" href="namespace_threading.html">Threading</a></li>
				<li class="footer">
					Generated on Sun Jan 17 2021 12:08:12 for Nebula. Dark theme by <a href="http://majerle.eu" target="_new">Tilen Majerle</a>. All rights reserved.
				</li>
			</ul>
		</div>
		<script src="custom.js"></script>
	</body>
</html>
