<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=9"/>
		<meta name="generator" content="Doxygen 1.9.0"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>Nebula: $title</title>
		<link href="tabs.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="dynsections.js"></script>
		<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
		<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
		<link href="doxygen.css" rel="stylesheet" type="text/css" />
		<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom_dark_theme.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectalign" style="padding-left: 0.5em;">
							<div id="projectname">Nebula
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part --><!-- Generated by Doxygen 1.9.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_net.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="contents">
<div class="textblock"><h1><a class="anchor" id="NebulaNetSystem"></a>
The Net Subsystem</h1>
<p>The Nebula <a class="el" href="namespace_net.html">Net</a> subsystem offers simple client/server-style communication using the TCP protocol over LAN or internet connections. It is not intended for highlevel game-oriented communication with lobbies, session management and synchronisation of player data. This will be provided in higher level Nebula networking subsystems.</p>
<h2><a class="anchor" id="NetIPAddress"></a>
Working with IP addresses</h2>
<p>An IpAddress object identifies a communication endpoint by host name or tcp/ip address and a port number. IpAddress objects can be created in a number of ways:</p>
<div class="fragment"><div class="line"><span class="comment">// from TCP/IP address and port number:</span></div>
<div class="line"><a class="code" href="class_net_1_1_ip_address.html">IpAddress</a> ipAddr(<span class="stringliteral">&quot;192.168.0.2&quot;</span>, 1234);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// from host name and port number:</span></div>
<div class="line"><a class="code" href="class_net_1_1_ip_address.html">IpAddress</a> ipAddr(<span class="stringliteral">&quot;www.radonlabs.de&quot;</span>, 1234);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// from the local host (127.0.0.1) and port number:</span></div>
<div class="line"><a class="code" href="class_net_1_1_ip_address.html">IpAddress</a> ipAddr(<span class="stringliteral">&quot;localhost&quot;</span>, 1234);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// from the &quot;any&quot; address (0.0.0.0) and a port number:</span></div>
<div class="line"><a class="code" href="class_net_1_1_ip_address.html">IpAddress</a> ipAddr(<span class="stringliteral">&quot;any&quot;</span>, 1234);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// from the broadcast address (255.255.255.255) and a port number:</span></div>
<div class="line"><a class="code" href="class_net_1_1_ip_address.html">IpAddress</a> ipAddr(<span class="stringliteral">&quot;broadcast&quot;</span>, 1234);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// from the host&#39;s first valid network adapter&#39;s address and a port number</span></div>
<div class="line"><a class="code" href="class_net_1_1_ip_address.html">IpAddress</a> ipAddr(<span class="stringliteral">&quot;self&quot;</span>, 1234);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// from the host&#39;s first valid network adapter connected to the internet and a port number:</span></div>
<div class="line"><a class="code" href="class_net_1_1_ip_address.html">IpAddress</a> ipAddr(<span class="stringliteral">&quot;insetself&quot;</span>, 1234);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// from an URI which defines a host name and a port number:</span></div>
<div class="line"><a class="code" href="class_net_1_1_ip_address.html">IpAddress</a> ipAddr(<a class="code" href="class_i_o_1_1_u_r_i.html">IO::URI</a>(<span class="stringliteral">&quot;http://www.radonlabs.de:2100&quot;</span>));</div>
<div class="ttc" id="aclass_i_o_1_1_u_r_i_html"><div class="ttname"><a href="class_i_o_1_1_u_r_i.html">IO::URI</a></div><div class="ttdoc">An URI object can split a Uniform Resource Identifier string into its components or build a string fr...</div><div class="ttdef"><b>Definition:</b> uri.h:67</div></div>
<div class="ttc" id="aclass_net_1_1_ip_address_html"><div class="ttname"><a href="class_net_1_1_ip_address.html">IpAddress</a></div><div class="ttdoc">Represents an IP address, consisting of a IPv4 host address and a port number.</div></div>
</div><!-- fragment --><p>An IpAddress object can be used to lookup a TCP/IP address from a host name:</p>
<div class="fragment"><div class="line"><a class="code" href="class_net_1_1_ip_address.html">IpAddress</a> ipAddr(<span class="stringliteral">&quot;www.radonlabs.de&quot;</span>, 0);</div>
<div class="line">String numericalAddr = ipAddr.GetHostAddr();</div>
</div><!-- fragment --><h2><a class="anchor" id="NetTcpServerClient"></a>
Setting Up A Client/Server System</h2>
<p>The <a class="el" href="namespace_net.html">Net</a> subsystem provides an easy-to-use TCP-based client/server system implemented in the classes TcpServer and TcpClient using the TCP protocol. Any number of TcpClients can be served by a single TcpServer simultanously.</p>
<p>Setting up a server is done like this:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_net.html">Net</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="class_ptr.html">Ptr&lt;TcpServer&gt;</a> tcpServer = <a class="code" href="namespace_game_1_1_time_manager.html#a18c6aa9e2f022cec2293bc8ba843ac6f">TcpServer::Create</a>();</div>
<div class="line">tcpServer-&gt;SetAddress(<a class="code" href="class_net_1_1_ip_address.html">IpAddress</a>(<span class="stringliteral">&quot;any&quot;</span>, 2352));</div>
<div class="line"><span class="keywordflow">if</span> (tcpServer-&gt;Open())</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// TcpServer successfully opened</span></div>
<div class="line">}</div>
<div class="ttc" id="aclass_ptr_html"><div class="ttname"><a href="class_ptr.html">Ptr</a></div><div class="ttdoc">Nebula's smart pointer class which manages the life time of RefCounted objects.</div><div class="ttdef"><b>Definition:</b> ptr.h:39</div></div>
<div class="ttc" id="anamespace_game_1_1_time_manager_html_a18c6aa9e2f022cec2293bc8ba843ac6f"><div class="ttname"><a href="namespace_game_1_1_time_manager.html#a18c6aa9e2f022cec2293bc8ba843ac6f">Game::TimeManager::Create</a></div><div class="ttdeci">Game::ManagerAPI Create()</div><div class="ttdoc">create the singleton</div><div class="ttdef"><b>Definition:</b> timemanager.cc:62</div></div>
<div class="ttc" id="anamespace_net_html"><div class="ttname"><a href="namespace_net.html">Net</a></div><div class="ttdef"><b>Definition:</b> debugmessage.h:20</div></div>
</div><!-- fragment --><p>This will setup the server to listen on port 2352 for incoming client connection requests.</p>
<p>To communicate with the TcpServer, a TcpClient object needs to be setup on the client side:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_net.html">Net</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="class_ptr.html">Ptr&lt;TcpClient&gt;</a> tcpClient = <a class="code" href="namespace_game_1_1_time_manager.html#a18c6aa9e2f022cec2293bc8ba843ac6f">TcpClient::Create</a>();</div>
<div class="line">tcpClient-&gt;SetBlocking(<span class="keyword">false</span>);</div>
<div class="line">tcpClient-&gt;SetAddress(<a class="code" href="class_net_1_1_ip_address.html">IpAddress</a>(<span class="stringliteral">&quot;localhost&quot;</span>, 2352));</div>
<div class="line">TcpClient::Result res = tcpClient-&gt;Connect();</div>
</div><!-- fragment --><p>This assumes that the server is running on the same machine as the client (since the client connects to "localhost").</p>
<p>In a non-blocking scenario as above, the Connect() method will either return with TcpClient::Success (which means the connection is established), or more likely with TcpClient::Connecting, in this case the connection hasn't been established yet, and the application needs to continue calling the Connect() method. In the case of an connection error, the return code TcpClient::Error will be returned.</p>
<p>In a blocking scenario the Connect() method will not return until either the connection has been established (result would be TcpClient::Success) or an error occured (TcpClient::Error).</p>
<dl class="section note"><dt>Note</dt><dd>An interactive application should never block during network communication and instead should provide continous feedback to the user what's going on.</dd></dl>
<p>Once a connection has been established, a TcpClientConnection object will be created on the server side for each connected client. The TcpClientConnection represents the client on the server and is used to receive data from the client and to send responses back to the client.</p>
<p>For sending and receiving data, <a class="el" href="class_i_o_1_1_stream.html" title="Offers an abstract interface for read/write access to a sequence of bytes.">IO::Stream</a> objects are used. By attaching <a class="el" href="class_i_o_1_1_stream_reader.html" title="Stream reader classes provide a specialized read-interface for a stream.">IO::StreamReader</a> and <a class="el" href="class_i_o_1_1_stream_writer.html" title="Stream writer classes provide a specialized write-interface for a stream.">IO::StreamWriter</a> objects to the communication streams it is very easy to encode and decode data from the stream.</p>
<dl class="section note"><dt>Note</dt><dd>Send-data is not sent immediately, instead the data will accumulate in the send stream until the Send() method is called.</dd></dl>
<p>To send some text data from a client to its server, obtain a pointer to the send stream, write data to it and call the Send() method:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_net.html">Net</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_i_o.html">IO</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// obtain pointer to client&#39;s send stream and attach a TextWriter</span></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="class_ptr.html">Ptr&lt;Stream&gt;</a>&amp; sendStream = tcpClient-&gt;GetSendStream();</div>
<div class="line"><a class="code" href="class_ptr.html">Ptr&lt;TextWriter&gt;</a> textWriter = <a class="code" href="namespace_game_1_1_time_manager.html#a18c6aa9e2f022cec2293bc8ba843ac6f">TextWriter::Create</a>();</div>
<div class="line">textWriter-&gt;SetStream(sendStream);</div>
<div class="line">textWriter-&gt;Open())</div>
<div class="line">textWriter-&gt;WriteString(<span class="stringliteral">&quot;Hello Server&quot;</span>);</div>
<div class="line">textWriter-&gt;Close();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// send off the data to the server</span></div>
<div class="line"><span class="keywordflow">if</span> (this-&gt;tcpClient-&gt;Send())</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// data has been sent</span></div>
<div class="line">}</div>
<div class="ttc" id="anamespace_i_o_html"><div class="ttname"><a href="namespace_i_o.html">IO</a></div><div class="ttdoc">Instances of wrapped stream classes.</div><div class="ttdef"><b>Definition:</b> archive.cc:10</div></div>
</div><!-- fragment --><p>To receive client data on the server side, the application needs to poll for TcpClientConnection which contain data from clients frequently (e.g. once per frame). More then one TcpClientConnection may be waiting for processing, thus the processing loop should look like this:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_util.html">Util</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_i_o.html">IO</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_net.html">Net</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// get array of client connections which received data since the last time</span></div>
<div class="line">Array&lt;Ptr&lt;TcpClientConnection&gt;&gt; recvConns = tcpServer-&gt;Recv();</div>
<div class="line"><a class="code" href="types_8h.html#ad119735112d40fd29a3017de944ccc98">IndexT</a> i;</div>
<div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; recvConns.Size(); i++)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// get receive stream from current connection, attach a text reader and read content</span></div>
<div class="line">    <a class="code" href="class_ptr.html">Ptr&lt;TextReader&gt;</a> textReader = <a class="code" href="namespace_game_1_1_time_manager.html#a18c6aa9e2f022cec2293bc8ba843ac6f">TextReader::Create</a>();</div>
<div class="line">    textReader-&gt;SetStream(recvConns[i]-&gt;GetRecvStream());</div>
<div class="line">    textReader-&gt;Open();</div>
<div class="line">    String str = textReader-&gt;ReadString();</div>
<div class="line">    textReader-&gt;Close();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// process received string and send response back to client</span></div>
<div class="line">    <span class="comment">// create a TextWriter and attach it to the send stream of the client connection</span></div>
<div class="line">    <a class="code" href="class_ptr.html">Ptr&lt;TextWriter&gt;</a> textWriter = <a class="code" href="namespace_game_1_1_time_manager.html#a18c6aa9e2f022cec2293bc8ba843ac6f">TextWriter::Create</a>();</div>
<div class="line">    textWriter-&gt;SetStream(recvConns[i]-&gt;GetSendStream());</div>
<div class="line">    textWriter-&gt;Open();</div>
<div class="line">    textWriter-&gt;WriteString(<span class="stringliteral">&quot;Hello Client&quot;</span>);</div>
<div class="line">    textWriter-&gt;Close();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// finally send the response back to the client</span></div>
<div class="line">    recvConns[i]-&gt;Send();</div>
<div class="line">}</div>
<div class="ttc" id="anamespace_util_html"><div class="ttname"><a href="namespace_util.html">Util</a></div><div class="ttdoc">Tuple helper functions and typedefs.</div><div class="ttdef"><b>Definition:</b> array.h:38</div></div>
<div class="ttc" id="atypes_8h_html_ad119735112d40fd29a3017de944ccc98"><div class="ttname"><a href="types_8h.html#ad119735112d40fd29a3017de944ccc98">IndexT</a></div><div class="ttdeci">int IndexT</div><div class="ttdef"><b>Definition:</b> types.h:48</div></div>
</div><!-- fragment --><p>To get server responses on the client side, call the TcpClient::Recv() method which will block until data arrives (in blocking mode), or come back immediately (in non-blocking mode) and return true when data from the server is available:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_net.html">Net</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_i_o.html">IO</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// check if data is available from the server</span></div>
<div class="line"><span class="keywordflow">if</span> (tcpClient-&gt;Recv())</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// yep, data is available, get the recv stream and read the data from it</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="class_ptr.html">Ptr&lt;Stream&gt;</a>&amp; recvStream = tcpClient-&gt;GetRecvStream();</div>
<div class="line">    <a class="code" href="class_ptr.html">Ptr&lt;TextReader&gt;</a> textReader = <a class="code" href="namespace_game_1_1_time_manager.html#a18c6aa9e2f022cec2293bc8ba843ac6f">TextReader::Create</a>();</div>
<div class="line">    textReader-&gt;SetStream(recvStream);</div>
<div class="line">    textReader-&gt;Open();</div>
<div class="line">    String responseString = textReader-&gt;ReadString();</div>
<div class="line">    <a class="code" href="debug_8cc.html#af49bb380724a6d5744e97bae90dbb5ae">n_printf</a>(<span class="stringliteral">&quot;The server said: %s\n&quot;</span>, responseString.AsCharPtr());</div>
<div class="line">    textReader-&gt;Close();</div>
<div class="line">}</div>
<div class="ttc" id="adebug_8cc_html_af49bb380724a6d5744e97bae90dbb5ae"><div class="ttname"><a href="debug_8cc.html#af49bb380724a6d5744e97bae90dbb5ae">n_printf</a></div><div class="ttdeci">void __cdecl n_printf(const char *msg,...)</div><div class="ttdoc">Nebula's printf replacement.</div><div class="ttdef"><b>Definition:</b> debug.cc:210</div></div>
</div><!-- fragment --><p>A client should also check whether the connection is still up by calling the IsConnected() method. If the connection has been dropped for some reason, this method will return false.</p>
<dl class="section note"><dt>Note</dt><dd>TcpServer and TcpClient do not implement an underlying communication protocol which enables them to work with "foreign" clients and servers (for instance, a TcpServer could work with standard web browsers as client, and a TcpClient class could communicate with a standard HTTP server).</dd></dl>
<p>For real world scenarios, an application should implement its own robust communication protocol which at least encodes the length of the payload data. If the payload is bigger then some maximum packet size, data may be sent in several packets, and thus may arrive in several packets at the client. The client should decode the length of the payload from the message header to decide whether the received data represents a complete message, or whether more data needs to be received until message is complete.</p>
<h2><a class="anchor" id="NetByteOrder"></a>
Byte Order Issues</h2>
<p>Servers and clients may run on CPUs with different byte order. If binary data is sent over a network connection, the data must be converted into a "network byte order" which both clients agree on. Nebula offers automatic byte order conversion in the <a class="el" href="class_i_o_1_1_binary_reader.html" title="A friendly interface to read binary data from a stream.">IO::BinaryReader</a> and <a class="el" href="class_i_o_1_1_binary_writer.html" title="A friendly interface for writing binary data to a stream.">IO::BinaryWriter</a> classes. Simply call the following methods before reading from or writing to a network communication stream:</p>
<div class="fragment"><div class="line">binaryReader-&gt;SetStreamByteOrder(<a class="code" href="class_system_1_1_byte_order.html#a69f674d97704ad498fbe89ff3da88e87a1a573935798e25bb7a0f48a103b201ea">System::ByteOrder::Network</a>);</div>
<div class="line">binaryWriter-&gt;SetStreamByteOrder(<a class="code" href="class_system_1_1_byte_order.html#a69f674d97704ad498fbe89ff3da88e87a1a573935798e25bb7a0f48a103b201ea">System::ByteOrder::Network</a>);</div>
<div class="ttc" id="aclass_system_1_1_byte_order_html_a69f674d97704ad498fbe89ff3da88e87a1a573935798e25bb7a0f48a103b201ea"><div class="ttname"><a href="class_system_1_1_byte_order.html#a69f674d97704ad498fbe89ff3da88e87a1a573935798e25bb7a0f48a103b201ea">System::ByteOrder::Network</a></div><div class="ttdeci">@ Network</div><div class="ttdef"><b>Definition:</b> byteorder.h:40</div></div>
</div><!-- fragment --><h2><a class="anchor" id="NetSocketClass"></a>
The Socket Class</h2>
<p>The <a class="el" href="namespace_net.html">Net</a> subsystem provides a Socket class which wraps the traditional socket functions into a C++ interface. Usually an application doesn't use Socket class directly and instead uses higher level networking classes like TcpServer. But if that's not possible for some reason the Socket class is much more convenient then working directly with socket functions. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
		<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
			<ul>
				<li class="navelem"><a class="el" href="foundation.html">Foundation Libraries</a></li>
				<li class="footer">
					Generated on Sun Jan 17 2021 18:59:57 for Nebula. Dark theme by <a href="http://majerle.eu" target="_new">Tilen Majerle</a>. All rights reserved.
				</li>
			</ul>
		</div>
		<script src="custom.js"></script>
	</body>
</html>
